---
title: "Datathon"
author: "Jackson Collis, Lily Lu, Eric Seo, Johnny Young"
date: "Apr 13, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Libraries
library(dplyr)
library(magrittr)
library(ggplot2)
library(ggmap)
```

```{r}
# Import Main Data
data <- read.csv('PRIMARY_flight_traffic.csv')

# Clean Data
data$diverted %<>% as.factor()
data$cancelled %<>% as.factor()

# Fare data 
fares <- read.csv('fares.csv')

# Clean Data
major <- c("UA", "AA", "DL", "US", "AS")
budget <- c("F9", "B6", "NK", "WN")
regional <- c("OO", "EV", "HA", "MQ", "VX")
fares$airline_type <- as.factor(ifelse(fares$airline_id %in% major, "Major", 
    ifelse(fares$airline_id %in% budget, "Budget", 
        ifelse(fares$airline_id %in% regional, "Regional", NA)) ))

 airlines <- c("AA" ,"AS" ,"B6" ,"DL" ,"EV" ,"F9" ,"HA" ,"NK" ,"OO" ,"UA" ,"VX" ,"WN")
fares <- fares[fares$airline_id %in% airlines, ]
summary(fares$airline_type)

# Stock data
stock <- read.csv('stock_prices.csv')

# Airport data
airport <- read.csv('airports.csv')

# Event data
events <- read.csv('events_US.csv')

# Weather data
weather <- read.csv('weather.csv')
```

```{r}
airport$airport_name <- NULL
airport$city <- NULL
airport$state <- NULL
data <- merge(data, airport, by.x = 'origin_airport', by.y = 'airport_id')

airportflightcount <- data %>% group_by(origin_airport, airline_id) %>% summarize(origincount = n())
airportflightcount <- merge(airportflightcount, airport, by.x = 'origin_airport', by.y = 'airport_id')

map<-get_map(location='united states', zoom=4, maptype = "terrain",
             ,color='color')
ggmap(map) + geom_point(data = airportflightcount, aes(x = longitude, y = latitude, size = origincount, colour = airline_id)) + guides(fill='legend', size=F) + scale_size(range = c(0, 6)) + scale_fill_gradient(low = "#ff0000", high = "#04ff00")
```
