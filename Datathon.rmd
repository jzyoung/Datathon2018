---
title: "Datathon"
author: "Jackson Collis, Lily Lu, Eric Seo, Johnny Young"
date: "Apr 13, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
# Libraries
library(dplyr)
library(magrittr)
library(ggplot2)
library(ggmap)
```

```{r}
# Import Main Data
data <- read.csv('PRIMARY_flight_traffic.csv')

# Clean Data
data$diverted %<>% as.factor()
data$cancelled %<>% as.factor()

# Fare data 
fares <- read.csv('fares.csv')
fares$airline_type <- as.factor(ifelse(fares$airline_id == "UA" | fares$airline_id == "AA" | fares$airline_id == "DL" | fares$airline_id == "US" | fares$airline_id == "AS", "Major", ifelse(fares$airline_id == "F9" | fares$airline_id == "B6" | fares$airline_id == "NK" | fares$airline_id == "WN", "Budget", ifelse(fares$airline_id == "OO" | fares$airline_id == "EV" | fares$airline_id == "HA" | fares$airline_id == "MQ" | fares$airline_id == "VX", "Regional", NA)) ))


# Stock data
stock <- read.csv('stock_prices.csv')

# Airport data
airport <- read.csv('airports.csv')

# Event data
events <- read.csv('events_US.csv')

# Weather data
weather <- read.csv('weather.csv')
```

```{r}
airport$airport_name <- NULL
airport$city <- NULL
airport$state <- NULL
data <- merge(data, airport, by.x = 'origin_airport', by.y = 'airport_id')

airportflightcount <- data %>% group_by(origin_airport, airline_id) %>% summarize(origincount = n())
airportflightcount <- merge(airportflightcount, airport, by.x = 'origin_airport', by.y = 'airport_id')

map<-get_map(location='united states', zoom=4, maptype = "terrain",
             ,color='color')
ggmap(map) + geom_point(data = airportflightcount, aes(x = longitude, y = latitude, size = origincount, colour = airline_id)) + guides(fill='legend', size=F) + scale_size(range = c(0, 6)) + scale_fill_gradient(low = "#ff0000", high = "#04ff00")
```
